import{_ as p,r as l,o,a as c,d as n,b as a,w as e,F as r,e as u,f as t}from"./app.98d1b083.js";const i={},k=n("div",{class:"custom-container info"},[n("p",{class:"custom-container-title"},"\u76F8\u5173\u4FE1\u606F"),n("p",null,"\u6587\u7AE0\u4ECB\u7ECD")],-1),m={class:"table-of-contents"},b=t("\u914D\u7F6E\u6587\u4EF6"),d=t("\u914D\u7F6E\u6587\u4EF6\u8BF4\u660E"),h=t("\u5404\u8282\u70B9\u914D\u7F6E"),g=t("\u521B\u5EFA\u79C1\u6709\u7F51\u7EDC"),q=t("\u9488\u5BF9\u62A5\u9519\u8FDB\u884C\u4FEE\u6539"),v=t("\u9519\u8BEF\u4E00"),y=t("\u9519\u8BEF\u4E8C"),_=t("\u542F\u52A8\u955C\u50CF"),f=t("\u914D\u7F6E\u6587\u4EF6"),x=t("\u542F\u52A8\u955C\u50CF"),w=t("\u62F7\u8D1D\u914D\u7F6E\u6587\u4EF6"),N=t("\u914D\u7F6E\u6587\u4EF6"),E=t("\u542F\u52A8\u5BB9\u5668"),O=u(`<hr><h1 id="\u955C\u50CF\u53CA\u63D2\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u955C\u50CF\u53CA\u63D2\u4EF6" aria-hidden="true">#</a> \u955C\u50CF\u53CA\u63D2\u4EF6</h1><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment"># es\u955C\u50CF</span>
docker pull elasticsearch:6.4.2
<span class="token comment"># kibana\u955C\u50CF</span>
docker pull kibana:6.4.2
<span class="token comment"># logstash\u955C\u50CF</span>
docker pull logstash:6.4.2
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h1 id="\u521B\u5EFA\u6302\u8F7D\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u6302\u8F7D\u5BF9\u8C61" aria-hidden="true">#</a> \u521B\u5EFA\u6302\u8F7D\u5BF9\u8C61</h1><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u2514\u2500\u2500 elk-clusters
    \u251C\u2500\u2500 config
    \u2502   \u251C\u2500\u2500 kibana
    \u2502   \u251C\u2500\u2500 logstack
    \u2502   \u2502   \u251C\u2500\u2500 config
    \u2502   \u2502   \u2514\u2500\u2500 pipeline
    \u2502   \u251C\u2500\u2500 node1
    \u2502   \u251C\u2500\u2500 node2
    \u2502   \u2514\u2500\u2500 node3
    \u251C\u2500\u2500 data
    \u2502   \u251C\u2500\u2500 node1
    \u2502   \u251C\u2500\u2500 node2
    \u2502   \u2514\u2500\u2500 node3
    \u251C\u2500\u2500 logs
    \u2502   \u251C\u2500\u2500 node1
    \u2502   \u251C\u2500\u2500 node2
    \u2502   \u2514\u2500\u2500 node3
    \u2514\u2500\u2500 plugins
        \u251C\u2500\u2500 node1
        \u251C\u2500\u2500 node2
        \u2514\u2500\u2500 node3
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ul><li>config \u914D\u7F6E\u6587\u4EF6\u6302\u8F7D</li><li>data \u6570\u636E\u6587\u4EF6\u6302\u8F7D</li><li>logs \u65E5\u5FD7\u6587\u4EF6\u6302\u8F7D</li><li>plugins \u63D2\u4EF6\u6302\u8F7D</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u5F00\u542F\u6587\u4EF6\u5939\u6743\u9650</span>
<span class="token function">chmod</span> <span class="token number">777</span> /mnt/elk-clusters/data/node1
<span class="token function">chmod</span> <span class="token number">777</span> /mnt/elk-clusters/data/node2
<span class="token function">chmod</span> <span class="token number">777</span> /mnt/elk-clusters/data/node3

<span class="token function">chmod</span> <span class="token number">777</span> /mnt/elk-clusters/logs/node1
<span class="token function">chmod</span> <span class="token number">777</span> /mnt/elk-clusters/logs/node2
<span class="token function">chmod</span> <span class="token number">777</span> /mnt/elk-clusters/logs/node3
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h1 id="elasticsearch" tabindex="-1"><a class="header-anchor" href="#elasticsearch" aria-hidden="true">#</a> ElasticSearch</h1><h2 id="\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> \u914D\u7F6E\u6587\u4EF6</h2><h3 id="\u914D\u7F6E\u6587\u4EF6\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u6587\u4EF6\u8BF4\u660E" aria-hidden="true">#</a> \u914D\u7F6E\u6587\u4EF6\u8BF4\u660E</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">cluster.name</span><span class="token punctuation">:</span> \u96C6\u7FA4\u540D\u79F0
<span class="token key atrule">node.name</span><span class="token punctuation">:</span> \u8282\u70B9\u7684\u540D\u79F0
<span class="token key atrule">node.master</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># \u662F\u4E0D\u662F\u6709\u8D44\u683C\u7ADE\u9009\u4E3B\u8282\u70B9</span>
<span class="token key atrule">node.data</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token comment"># \u662F\u5426\u5B58\u50A8\u6570\u636E</span>
<span class="token key atrule">node.max_local_storage_nodes</span><span class="token punctuation">:</span> <span class="token number">3</span>  <span class="token comment">#\u6700\u5927\u96C6\u7FA4\u8282\u70B9\u6570</span>
<span class="token key atrule">bootstrap.memory_lock</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#\u662F\u5426\u5F00\u542F\u65F6\u9501\u5B9A\u5185\u5B58\uFF08\u9ED8\u8BA4\u4E3A\u662F\uFF09</span>
<span class="token comment"># \u6CE8\u610F\u8FD9\u4E24\u4E2A\u8DEF\u5F84\u4E0D\u8981\u914D\u7F6E\u7269\u7406\u673A\u7684\u8DEF\u5F84\u4E86\uFF0C\u8FD9\u662F\u3010\u5BB9\u5668\u5185\u90E8\u3011\u7684\u8DEF\u5F84\uFF01\uFF01</span>
<span class="token key atrule">path.data</span><span class="token punctuation">:</span> /usr/share/elasticsearch/data <span class="token comment"># \u6570\u636E\u5B58\u6863\u4F4D\u7F6E</span>
<span class="token key atrule">path.logs</span><span class="token punctuation">:</span> /usr/share/elasticsearch/log   <span class="token comment"># \u65E5\u5FD7\u5B58\u653E\u4F4D\u7F6E</span>
<span class="token comment"># \u914D\u5408network.publish_host \u4E00\u8D77\u4F7F\u7528\u3002\u53C2\u89C1\u4E0B\u6587\u7684\u5C0F\u7A8D\u95E8\uFF1A</span>
<span class="token key atrule">network.host</span><span class="token punctuation">:</span> 10.10.10.11 <span class="token comment">#\u8BBE\u7F6E\u7F51\u5173\u5730\u5740</span>
<span class="token comment"># \u8BBE\u7F6E\u5176\u5B83\u7ED3\u70B9\u548C\u8BE5\u7ED3\u70B9\u4EA4\u4E92\u7684ip\u5730\u5740\uFF0C\u5982\u679C\u4E0D\u8BBE\u7F6E\u5B83\u4F1A\u81EA\u52A8\u5224\u65AD\uFF0C\u503C\u5FC5\u987B\u662F\u4E2A\u771F\u5B9E\u7684ip\u5730\u5740\uFF0C\u8BBE\u7F6E\u5F53\u524D\u7269\u7406\u673A\u5730\u5740,\u5982\u679C\u662Fdocker\u5B89\u88C5\u8282\u70B9\u7684IP\u5C06\u4F1A\u662F\u914D\u7F6E\u7684IP\u800C\u4E0D\u662Fdocker\u7F51\u7BA1ip</span>
<span class="token comment"># network.publish_host: 10.10.10.11</span>
<span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">9200</span>  <span class="token comment"># \u8BBE\u7F6E\u6620\u5C04\u7AEF\u53E3</span>
<span class="token key atrule">transport.tcp.port</span><span class="token punctuation">:</span> <span class="token number">9300</span>  <span class="token comment"># \u5185\u90E8\u8282\u70B9\u4E4B\u95F4\u6C9F\u901A\u7AEF\u53E3 </span>
<span class="token comment"># \u7EC4\u64AD\u5730\u5740</span>
<span class="token key atrule">discovery.seed_hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;10.10.10.12:9300&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;10.10.10.13:9300&quot;</span><span class="token punctuation">]</span>
<span class="token comment"># es7.x \u4E4B\u540E\u65B0\u589E\u7684\u914D\u7F6E\uFF0C\u5199\u5165\u5019\u9009\u4E3B\u8282\u70B9\u7684\u8BBE\u5907\u5730\u5740\uFF0C\u5728\u5F00\u542F\u670D\u52A1\u540E\u53EF\u4EE5\u88AB\u9009\u4E3A\u4E3B\u8282\u70B9</span>
<span class="token key atrule">cluster.initial_master_nodes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node-1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node-2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node-3&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="\u5404\u8282\u70B9\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u5404\u8282\u70B9\u914D\u7F6E" aria-hidden="true">#</a> \u5404\u8282\u70B9\u914D\u7F6E</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">## \u8282\u70B91\u914D\u7F6E\u4FE1\u606F\u5982\u4E0B\uFF1A</span>
<span class="token comment"># \u6587\u4EF6\u8DEF\u5F84 /mnt/elk-clusters/config/node1/elasticsearch.yml</span>
<span class="token key atrule">cluster.name</span><span class="token punctuation">:</span> elk<span class="token punctuation">-</span>v7
<span class="token key atrule">node.name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span><span class="token number">1</span>
<span class="token key atrule">node.master</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">node.data</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">node.max_local_storage_nodes</span><span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token key atrule">path.data</span><span class="token punctuation">:</span> /usr/share/elasticsearch/data
<span class="token key atrule">path.logs</span><span class="token punctuation">:</span> /usr/share/elasticsearch/log
<span class="token key atrule">bootstrap.memory_lock</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">network.host</span><span class="token punctuation">:</span> 0.0.0.0
<span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">9200</span>
<span class="token key atrule">transport.tcp.port</span><span class="token punctuation">:</span> <span class="token number">9300</span>
<span class="token key atrule">discovery.seed_hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;10.10.10.12:9300&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;10.10.10.13:9300&quot;</span><span class="token punctuation">]</span>
<span class="token key atrule">cluster.initial_master_nodes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node-1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node-2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node-3&quot;</span><span class="token punctuation">]</span>
<span class="token comment">## \u8282\u70B92\u914D\u7F6E\u4FE1\u606F\u5982\u4E0B\uFF1A</span>
<span class="token comment"># \u6587\u4EF6\u8DEF\u5F84 /mnt/elk-clusters/config/node2/elasticsearch.yml</span>
<span class="token key atrule">cluster.name</span><span class="token punctuation">:</span> elk<span class="token punctuation">-</span>v7
<span class="token key atrule">node.name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span><span class="token number">2</span>
<span class="token key atrule">node.master</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">node.data</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">node.max_local_storage_nodes</span><span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token key atrule">path.data</span><span class="token punctuation">:</span> /usr/share/elasticsearch/data
<span class="token key atrule">path.logs</span><span class="token punctuation">:</span> /usr/share/elasticsearch/log
<span class="token key atrule">bootstrap.memory_lock</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">network.host</span><span class="token punctuation">:</span> 0.0.0.0
<span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">9200</span>
<span class="token key atrule">transport.tcp.port</span><span class="token punctuation">:</span> <span class="token number">9300</span>
<span class="token key atrule">discovery.seed_hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;10.10.10.11:9300&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;10.10.10.13:9300&quot;</span><span class="token punctuation">]</span>
<span class="token key atrule">cluster.initial_master_nodes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node-1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node-2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node-3&quot;</span><span class="token punctuation">]</span>
<span class="token comment">## \u8282\u70B93\u914D\u7F6E\u4FE1\u606F\u5982\u4E0B\uFF1A</span>
<span class="token comment"># \u6587\u4EF6\u8DEF\u5F84 /mnt/elk-clusters/config/node3/elasticsearch.yml</span>
<span class="token key atrule">cluster.name</span><span class="token punctuation">:</span> elk<span class="token punctuation">-</span>v7
<span class="token key atrule">node.name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span><span class="token number">3</span>
<span class="token key atrule">node.master</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">node.data</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">node.max_local_storage_nodes</span><span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token key atrule">path.data</span><span class="token punctuation">:</span> /usr/share/elasticsearch/data
<span class="token key atrule">path.logs</span><span class="token punctuation">:</span> /usr/share/elasticsearch/log
<span class="token key atrule">bootstrap.memory_lock</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">network.host</span><span class="token punctuation">:</span> 0.0.0.0
<span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">9200</span>
<span class="token key atrule">transport.tcp.port</span><span class="token punctuation">:</span> <span class="token number">9300</span>
<span class="token key atrule">discovery.seed_hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;10.10.10.11:9300&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;10.10.10.12:9300&quot;</span><span class="token punctuation">]</span>
<span class="token key atrule">cluster.initial_master_nodes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node-1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node-2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node-3&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h2 id="\u521B\u5EFA\u79C1\u6709\u7F51\u7EDC" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u79C1\u6709\u7F51\u7EDC" aria-hidden="true">#</a> \u521B\u5EFA\u79C1\u6709\u7F51\u7EDC</h2><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code>docker network create --driver=bridge --subnet=10.10.0.0/16 --ip-range=10.10.10.0/24 --gateway=10.10.10.254 elk-net
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="\u9488\u5BF9\u62A5\u9519\u8FDB\u884C\u4FEE\u6539" tabindex="-1"><a class="header-anchor" href="#\u9488\u5BF9\u62A5\u9519\u8FDB\u884C\u4FEE\u6539" aria-hidden="true">#</a> \u9488\u5BF9\u62A5\u9519\u8FDB\u884C\u4FEE\u6539</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">..</span>.
\u51FA\u73B0\u9519\u8BEF\u3002\u3002\u3002\u3002\u3002
ERROR: <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> bootstrap checks failed
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: memory locking requested <span class="token keyword">for</span> elasticsearch process but memory is not locked
<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: max virtual memory areas vm.max_map_count <span class="token punctuation">[</span><span class="token number">65530</span><span class="token punctuation">]</span> is too low, increase to at least <span class="token punctuation">[</span><span class="token number">262144</span><span class="token punctuation">]</span>
ERROR: Elasticsearch did not <span class="token builtin class-name">exit</span> normally - check the logs at /usr/share/elasticsearch/log/elk-v7.log
<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;server&quot;</span>, <span class="token string">&quot;timestamp&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2020-12-14T09:05:19,181Z&quot;</span>, <span class="token string">&quot;level&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;INFO&quot;</span>, <span class="token string">&quot;component&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;o.e.n.Node&quot;</span>, <span class="token string">&quot;cluster.name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;elk-v7&quot;</span>, <span class="token string">&quot;node.name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;node-1&quot;</span>, <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;stopping ...&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;server&quot;</span>, <span class="token string">&quot;timestamp&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2020-12-14T09:05:19,199Z&quot;</span>, <span class="token string">&quot;level&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;INFO&quot;</span>, <span class="token string">&quot;component&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;o.e.n.Node&quot;</span>, <span class="token string">&quot;cluster.name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;elk-v7&quot;</span>, <span class="token string">&quot;node.name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;node-1&quot;</span>, <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;stopped&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;server&quot;</span>, <span class="token string">&quot;timestamp&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2020-12-14T09:05:19,199Z&quot;</span>, <span class="token string">&quot;level&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;INFO&quot;</span>, <span class="token string">&quot;component&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;o.e.n.Node&quot;</span>, <span class="token string">&quot;cluster.name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;elk-v7&quot;</span>, <span class="token string">&quot;node.name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;node-1&quot;</span>, <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;closing ...&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;server&quot;</span>, <span class="token string">&quot;timestamp&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2020-12-14T09:05:19,216Z&quot;</span>, <span class="token string">&quot;level&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;INFO&quot;</span>, <span class="token string">&quot;component&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;o.e.n.Node&quot;</span>, <span class="token string">&quot;cluster.name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;elk-v7&quot;</span>, <span class="token string">&quot;node.name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;node-1&quot;</span>, <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;closed&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="\u9519\u8BEF\u4E00" tabindex="-1"><a class="header-anchor" href="#\u9519\u8BEF\u4E00" aria-hidden="true">#</a> \u9519\u8BEF\u4E00</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u6211\u4EEC\u662F\u901A\u8FC7Docker\u90E8\u7F72\u7684\uFF0C\u4E0A\u9762\u7684\u65B9\u6CD5\u53EF\u80FD\u4E0D\u9002\u7528\u8FD9\u79CD\u65B9\u5F0F\u3002\u53EF\u4EE5\u5728\u914D\u7F6E\u4E0B\u5982\u4E0B\u914D\u7F6E\u3002
<span class="token comment"># \u5168\u5C40\u751F\u6548\u65B9\u5F0F:</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/systemd/system.conf
<span class="token comment"># \u6DFB\u52A0\uFF1A</span>
<span class="token assign-left variable">DefaultLimitNOFILE</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token assign-left variable">DefaultLimitNPROC</span><span class="token operator">=</span><span class="token number">32000</span>
<span class="token assign-left variable">DefaultLimitMEMLOCK</span><span class="token operator">=</span>infinity
<span class="token comment"># \u4FDD\u5B58\u91CD\u542F\u5B9E\u4F8B\u3002</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="\u9519\u8BEF\u4E8C" tabindex="-1"><a class="header-anchor" href="#\u9519\u8BEF\u4E8C" aria-hidden="true">#</a> \u9519\u8BEF\u4E8C</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u5728  /etc/sysctl.conf\u6587\u4EF6\u6700\u540E\u6DFB\u52A0\u4E00\u884C
vm.max_map_count<span class="token operator">=</span><span class="token number">262144</span>
<span class="token comment"># \u91CD\u542F\u5B9E\u4F8B</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="\u542F\u52A8\u955C\u50CF" tabindex="-1"><a class="header-anchor" href="#\u542F\u52A8\u955C\u50CF" aria-hidden="true">#</a> \u542F\u52A8\u955C\u50CF</h2><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment"># \u8282\u70B9\u4E00</span>
docker run -d --name es-node-1 --network=elk-net --ip=10.10.10.11 -e ES_JAVA_OPTS=&quot;-Xms256m -Xmx256m&quot; -p 9201:9200 -p 9301:9300 -v /mnt/elk-clusters/config/node1/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml -v /mnt/elk-clusters/plugins/node1:/usr/share/elasticsearch/plugins -v /mnt/elk-clusters/data/node1:/usr/share/elasticsearch/data -v /mnt/elk-clusters/logs/node1:/usr/share/elasticsearch/logs --privileged=true elasticsearch:7.6.1

<span class="token comment"># \u8282\u70B9\u4E8C</span>
docker run -d --name es-node-2 --network=elk-net --ip=10.10.10.12 -e ES_JAVA_OPTS=&quot;-Xms256m -Xmx256m&quot; -p 9202:9200 -p 9302:9300 -v /mnt/elk-clusters/config/node2/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml -v /mnt/elk-clusters/plugins/node2:/usr/share/elasticsearch/plugins -v /mnt/elk-clusters/data/node2:/usr/share/elasticsearch/data -v /mnt/elk-clusters/logs/node1:/usr/share/elasticsearch/logs --privileged=true elasticsearch:7.6.1



<span class="token comment"># \u8282\u70B9\u4E09</span>
docker run -d --name es-node-3 --network=elk-net --ip=10.10.10.13 -e ES_JAVA_OPTS=&quot;-Xms256m -Xmx256m&quot; -p 9203:9200 -p 9303:9300 -v /mnt/elk-clusters/config/node3/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml -v /mnt/elk-clusters/plugins/node3:/usr/share/elasticsearch/plugins -v /mnt/elk-clusters/data/node3:/usr/share/elasticsearch/data -v /mnt/elk-clusters/logs/node1:/usr/share/elasticsearch/logs --privileged=true elasticsearch:7.6.1
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h1 id="kibana" tabindex="-1"><a class="header-anchor" href="#kibana" aria-hidden="true">#</a> Kibana</h1><h2 id="\u914D\u7F6E\u6587\u4EF6-1" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u6587\u4EF6-1" aria-hidden="true">#</a> \u914D\u7F6E\u6587\u4EF6</h2><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">#Kibana\u7684\u6620\u5C04\u7AEF\u53E3</span>
<span class="token key atrule">server.port</span><span class="token punctuation">:</span> <span class="token number">5601</span>
<span class="token comment">#\u7F51\u5173\u5730\u5740</span>
<span class="token key atrule">server.host</span><span class="token punctuation">:</span> <span class="token string">&quot;0.0.0.0&quot;</span>
<span class="token comment">#Kibana\u5B9E\u4F8B\u5BF9\u5916\u5C55\u793A\u7684\u540D\u79F0</span>
<span class="token key atrule">server.name</span><span class="token punctuation">:</span> <span class="token string">&quot;kibana&quot;</span>
<span class="token comment">#Elasticsearch\u7684\u96C6\u7FA4\u5730\u5740\uFF0C\u4E5F\u5C31\u662F\u8BF4\u6240\u6709\u7684\u96C6\u7FA4IP\uFF0C\u540C\u4E00\u4E2Adocker network\u4E0B\u4F7F\u7528\u4E86\u4E0D\u540Cip</span>
<span class="token key atrule">elasticsearch.hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;http://10.10.10.11:9200&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;http://10.10.10.12:9200&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;http://10.10.10.13:9200&quot;</span><span class="token punctuation">]</span>
<span class="token comment">#\u8BBE\u7F6E\u9875\u9762\u8BED\u8A00\uFF0C\u4E2D\u6587\u4F7F\u7528zh-CN\uFF0C\u82F1\u6587\u4F7F\u7528en</span>
<span class="token key atrule">i18n.locale</span><span class="token punctuation">:</span> <span class="token string">&quot;zh-CN&quot;</span>
<span class="token key atrule">xpack.monitoring.ui.container.elasticsearch.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="\u542F\u52A8\u955C\u50CF-1" tabindex="-1"><a class="header-anchor" href="#\u542F\u52A8\u955C\u50CF-1" aria-hidden="true">#</a> \u542F\u52A8\u955C\u50CF</h2><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code>docker run -d --name kibana --network=elk-net --ip=10.10.10.14 -p 5601:5601 -v /mnt/elk-clusters/config/kibana/kibana.yml:/usr/share/kibana/config/kibana.yml --privileged=true kibana:7.6.1
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h1 id="logstack" tabindex="-1"><a class="header-anchor" href="#logstack" aria-hidden="true">#</a> Logstack</h1><h2 id="\u62F7\u8D1D\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u62F7\u8D1D\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> \u62F7\u8D1D\u914D\u7F6E\u6587\u4EF6</h2><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment"># \u542F\u52A8\u5BB9\u5668</span>
docker run -d --name logstash logstash:7.6.1
<span class="token comment"># \u62F7\u8D1Dlogstash\u7684\u914D\u7F6E\u6587\u4EF6</span>
docker cp logstash:/usr/share/logstash/config /mnt/elk-clusters/config/logstack/config
<span class="token comment"># \u67E5\u770B\u5BF9\u5E94\u7684\u914D\u7F6E\u6587\u4EF6</span>
tree
\u251C\u2500\u2500 config
\u2502   \u2514\u2500\u2500 config
\u2502       \u251C\u2500\u2500 jvm.options
\u2502       \u251C\u2500\u2500 log4j2.properties
\u2502       \u251C\u2500\u2500 logstash-sample.conf
\u2502       \u251C\u2500\u2500 logstash.yml
\u2502       \u251C\u2500\u2500 pipelines.yml
\u2502       \u2514\u2500\u2500 startup.options
\u2514\u2500\u2500 pipeline

<span class="token comment"># \u505C\u6B62\u548C\u5220\u9664\u539F\u6709\u955C\u50CF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="\u914D\u7F6E\u6587\u4EF6-2" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u6587\u4EF6-2" aria-hidden="true">#</a> \u914D\u7F6E\u6587\u4EF6</h2><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># \u4FEE\u6539\u914D\u7F6E\u6587\u4EF6logstash.yml</span>
<span class="token key atrule">http.host</span><span class="token punctuation">:</span> <span class="token string">&quot;0.0.0.0&quot;</span>
<span class="token comment"># \u53EF\u4EE5\u914D\u7F6E\u591A\u4E2Aelasticsearch\u5730\u5740</span>
<span class="token key atrule">xpack.monitoring.elasticsearch.hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;http://10.10.10.11:9200&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;http://10.10.10.12:9200&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;http://10.10.10.13:9200&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># \u5728 pipeline \u4E0B\u521B\u5EFA logstash.conf</span>
<span class="token comment"># Sample Logstash configuration for creating a simple</span>
<span class="token comment"># Beats -&gt; Logstash -&gt; Elasticsearch pipeline.</span>
input <span class="token punctuation">{</span>
  beats <span class="token punctuation">{</span>
    port =<span class="token punctuation">&gt;</span> 5044
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
output <span class="token punctuation">{</span>
  elasticsearch <span class="token punctuation">{</span>
    hosts =<span class="token punctuation">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;http://10.10.10.11:9200&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;http://10.10.10.12:9200&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;http://10.10.10.13:9200&quot;</span><span class="token punctuation">]</span>
    index =<span class="token punctuation">&gt;</span> &quot;%<span class="token punctuation">{</span><span class="token punctuation">[</span>@metadata<span class="token punctuation">]</span><span class="token punctuation">[</span>beat<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">-</span>%<span class="token punctuation">{</span><span class="token punctuation">[</span>@metadata<span class="token punctuation">]</span><span class="token punctuation">[</span>version<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">-</span>%<span class="token punctuation">{</span>+YYYY.MM.dd<span class="token punctuation">}</span>&quot;
    <span class="token comment">#user =&gt; &quot;elastic&quot;</span>
    <span class="token comment">#password =&gt; &quot;changeme&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="\u542F\u52A8\u5BB9\u5668" tabindex="-1"><a class="header-anchor" href="#\u542F\u52A8\u5BB9\u5668" aria-hidden="true">#</a> \u542F\u52A8\u5BB9\u5668</h2><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code>docker run -d --name logstash --network=elk-net --ip=10.10.10.15 -v /mnt/elk-clusters/config/logstack/config/:/usr/share/logstash/config/ -v /mnt/elk-clusters/config/logstack/pipeline:/usr/share/logstash/pipeline -p 5044:5044 -p 9600:9600 --privileged=true logstash:7.6.1
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h1 id="ik\u5206\u8BCD\u5668" tabindex="-1"><a class="header-anchor" href="#ik\u5206\u8BCD\u5668" aria-hidden="true">#</a> ik\u5206\u8BCD\u5668</h1><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u5207\u6362\u5230node-1\u7684plugins\u76EE\u5F55\u4E0B\uFF0C\u89E3\u538B\u6587\u4EF6\u5230ik\u6587\u4EF6\u5939</span>
<span class="token function">unzip</span> elasticsearch-analysis-ik-7.6.1.zip -d ik
<span class="token comment"># \u91CD\u542F\u5BB9\u5668\uFF0C\u5176\u4ED6\u8282\u70B9\u91CD\u590D\u6B64\u64CD\u4F5C</span>
<span class="token function">docker</span> restart es-node-1
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h1 id="elasticsearch-head\u63D2\u4EF6" tabindex="-1"><a class="header-anchor" href="#elasticsearch-head\u63D2\u4EF6" aria-hidden="true">#</a> elasticsearch-head\u63D2\u4EF6</h1><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment"># \u955C\u50CF</span>
docker pull mobz/elasticsearch-head:5
<span class="token comment"># \u5B89\u88C5</span>
docker run -d -p 9100:9100 mobz/elasticsearch-head:5
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>`,40);function L(R,S){const s=l("RouterLink");return o(),c(r,null,[k,n("nav",m,[n("ul",null,[n("li",null,[a(s,{to:"#\u914D\u7F6E\u6587\u4EF6"},{default:e(()=>[b]),_:1}),n("ul",null,[n("li",null,[a(s,{to:"#\u914D\u7F6E\u6587\u4EF6\u8BF4\u660E"},{default:e(()=>[d]),_:1})]),n("li",null,[a(s,{to:"#\u5404\u8282\u70B9\u914D\u7F6E"},{default:e(()=>[h]),_:1})])])]),n("li",null,[a(s,{to:"#\u521B\u5EFA\u79C1\u6709\u7F51\u7EDC"},{default:e(()=>[g]),_:1})]),n("li",null,[a(s,{to:"#\u9488\u5BF9\u62A5\u9519\u8FDB\u884C\u4FEE\u6539"},{default:e(()=>[q]),_:1}),n("ul",null,[n("li",null,[a(s,{to:"#\u9519\u8BEF\u4E00"},{default:e(()=>[v]),_:1})]),n("li",null,[a(s,{to:"#\u9519\u8BEF\u4E8C"},{default:e(()=>[y]),_:1})])])]),n("li",null,[a(s,{to:"#\u542F\u52A8\u955C\u50CF"},{default:e(()=>[_]),_:1})]),n("li",null,[a(s,{to:"#\u914D\u7F6E\u6587\u4EF6-1"},{default:e(()=>[f]),_:1})]),n("li",null,[a(s,{to:"#\u542F\u52A8\u955C\u50CF-1"},{default:e(()=>[x]),_:1})]),n("li",null,[a(s,{to:"#\u62F7\u8D1D\u914D\u7F6E\u6587\u4EF6"},{default:e(()=>[w]),_:1})]),n("li",null,[a(s,{to:"#\u914D\u7F6E\u6587\u4EF6-2"},{default:e(()=>[N]),_:1})]),n("li",null,[a(s,{to:"#\u542F\u52A8\u5BB9\u5668"},{default:e(()=>[E]),_:1})])])]),O],64)}var T=p(i,[["render",L]]);export{T as default};
